<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen flex items-center">

  <div class="relative ml-10">

    <img
      id="desenho"
      src="/images/feliz.png"
      class="w-[700px] cursor-pointer select-none"
    />

    <!-- Balão de fala -->
    <img
      id="balao"
      src="/images/balao.png"
      class="absolute top-1 left-[700px] w-120 hidden pointer-events-none"
    />

    <!-- Texto dentro do balão -->
    <p
      id="fala"
      class="absolute top-[140px] left-[850px] w-[400px] text-center text-[30px] font-bold text-black hidden pointer-events-none leading-tight"
    ></p>
  </div>

  <script>
    const img = document.getElementById("desenho");
    const balao = document.getElementById("balao");
    const fala = document.getElementById("fala");

    let timeoutId = null;

    img.onclick = async () => {
      img.src = "/images/raiva.png";

      if (timeoutId) {
        clearTimeout(timeoutId);
        timeoutId = null;
      }

      try {
        const res = await fetch("http://localhost:3000/reclamar?evento=click");
        const data = await res.json();

        balao.classList.remove("hidden");
        fala.classList.remove("hidden");
        fala.innerText = data.texto;

      } catch {
        balao.classList.remove("hidden");
        fala.classList.remove("hidden");
        fala.innerText = "Haha! Nem achei ruim porque deu erro!";
      }

      timeoutId = setTimeout(() => {
        img.src = "/images/feliz.png";
        balao.classList.add("hidden");
        fala.classList.add("hidden");
        fala.innerText = "";
        timeoutId = null;
      }, 3000);
    };
  </script>

</body>
</html>
